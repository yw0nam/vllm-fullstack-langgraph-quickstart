# 설정 적용 (Apply Settings) 기능 가이드

## 📋 개요

사이드바에 "✅ 설정 적용" 버튼이 추가되었습니다. 이 버튼을 통해 사용자가 입력한 API 키들을 현재 세션의 환경 변수에 즉시 적용할 수 있습니다.

## 🎯 주요 기능

### 1. 실시간 API 키 적용
- 사용자가 입력한 API 키를 현재 실행 중인 세션에 즉시 적용
- 환경 변수 (`os.environ`)와 config 객체를 동시에 업데이트
- 애플리케이션 재시작 없이 새로운 API 키 사용 가능

### 2. 지원하는 API 키
- **Gemini API Key**: Google Gemini 모델 사용을 위한 키
- **Tavily API Key**: Tavily 검색 엔진 사용을 위한 키  
- **Google API Key**: Google Search grounding 기능 사용을 위한 키 (모델 선택과 무관하게 필요)

### 3. 모델과 검색 엔진 조합
- **vLLM + Tavily**: vLLM 환경설정 + Tavily API 키 필요
- **vLLM + Google Search**: vLLM 환경설정 + Google API 키 필요 (Google Search grounding)
- **Gemini + Tavily**: Google API 키 (모델용) + Tavily API 키 (검색용) 필요
- **Gemini + Google Search**: Google API 키 하나로 모델과 검색 모두 사용

### 3. 스마트한 UI 피드백
- 🔔 적용 대기 중인 설정이 있을 때 버튼에 알림 표시
- 💡 API 키 입력 시 "설정 적용 필요" 안내 메시지
- ✅ 적용 완료 시 성공 메시지와 함께 어떤 설정이 적용되었는지 표시

## 🔧 사용 방법

### 단계별 사용법

1. **API 키 입력**
   - 모델 선택 섹션에서 원하는 모델 선택 (Gemini 또는 vLLM)
   - 검색 엔진 선택 (Tavily 또는 Google)
   - 해당하는 API 키 입력 필드에 키 입력

2. **설정 상태 확인**
   - 입력한 키가 기존 환경 변수와 다를 경우 "💡 API 키를 입력했습니다. '✅ 설정 적용' 버튼을 눌러 적용하세요." 메시지 표시
   - 적용 버튼에 🔔 알림 아이콘 표시

3. **설정 적용**
   - "✅ 설정 적용" 버튼 클릭
   - 성공 메시지와 함께 적용된 설정 목록 확인
   - 새로운 대화에서 적용된 API 키 사용 가능

## 📊 현재 설정 섹션 개선

### 상세한 상태 표시
설정 정보 섹션에서 각 API 키의 상태를 자세히 표시:

- **✅ 설정됨 (환경변수에서)**: .env 파일에서 로드된 키
- **✅ 설정됨 (사용자입력 - 적용 필요)**: 입력되었지만 아직 적용되지 않은 키
- **✅ 설정됨 (환경변수 + 사용자입력 병합됨)**: 환경변수와 사용자입력이 모두 있고 적용된 상태
- **❌ 설정되지 않음**: 키가 없는 상태

## 💡 주요 장점

### 1. 개발 편의성
- 환경 변수 파일(.env) 수정 없이 즉시 API 키 테스트 가능
- 여러 API 키를 동적으로 전환하여 테스트 가능

### 2. 사용자 친화성
- 직관적인 UI로 현재 설정 상태를 한눈에 파악
- 명확한 피드백으로 적용 필요 여부 안내

### 3. 안전성
- 기존 환경 변수는 유지하면서 세션 레벨에서만 오버라이드
- 입력된 키만 선택적으로 적용 (빈 키는 무시)

## 🔍 기술 구현 세부사항

### 핵심 메서드

```python
def _apply_user_settings(self):
    """사용자가 입력한 API 키들을 현재 설정에 적용합니다."""
    # os.environ과 self.config를 동시에 업데이트
    # 적용된 설정 목록을 사용자에게 피드백
```

```python
def _has_pending_settings(self):
    """적용되지 않은 사용자 설정이 있는지 확인합니다."""
    # 입력된 키와 현재 config의 키를 비교하여 적용 필요 여부 판단
```

### 세션 상태 관리
- `st.session_state.settings_applied`: 설정 적용 상태 추적
- 사용자 입력 키들과 현재 config 키들을 비교하여 동적 상태 관리

## 🚀 사용 시나리오

### 시나리오 1: 새로운 API 키 테스트
1. Gemini API 키를 새로 발급받음
2. 사이드바에서 Gemini 선택 후 새 키 입력
3. "설정 적용" 버튼으로 즉시 적용
4. 바로 새로운 키로 대화 시작

### 시나리오 2: vLLM + Google Search 조합 사용
1. 로컬 vLLM 서버는 이미 실행 중
2. Google Search를 사용하고 싶음
3. Google API 키 입력 후 설정 적용
4. 검색 타입을 Google로 변경
5. vLLM 모델로 대화하면서 Google Search grounding으로 검색 수행

### 시나리오 3: 검색 엔진 전환
1. Tavily에서 Google Search로 전환하고 싶음
2. Google API 키 입력 후 설정 적용
3. 검색 타입을 Google로 변경
4. Google Search grounding 기능 사용

이 기능을 통해 사용자는 더욱 유연하고 편리하게 다양한 API 키를 테스트하고 사용할 수 있습니다.